<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="theme-color" content="#111827" />
    <title>Quoroom</title>
    <style>
      :root {
        color-scheme: dark;
      }
      body {
        margin: 0;
        min-height: 100vh;
        display: grid;
        place-items: center;
        padding: 24px;
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
        background: #0b1020;
        color: #e6ebff;
      }
      .card {
        width: min(440px, 100%);
        border: 1px solid #2a345a;
        border-radius: 14px;
        background: #131a31;
        padding: 18px;
      }
      h1 {
        margin: 0 0 8px;
        font-size: 20px;
      }
      p {
        margin: 0 0 10px;
        color: #a9b3d9;
        line-height: 1.5;
      }
      button {
        border: 0;
        border-radius: 10px;
        background: #f59542;
        color: #1d140b;
        font-weight: 700;
        padding: 10px 12px;
        cursor: pointer;
      }
      .spinner {
        width: 18px;
        height: 18px;
        border: 2px solid #2a345a;
        border-top-color: #f59542;
        border-radius: 50%;
        animation: spin 0.8s linear infinite;
        display: inline-block;
        vertical-align: middle;
        margin-right: 8px;
      }
      @keyframes spin {
        to { transform: rotate(360deg); }
      }
      .status {
        font-size: 13px;
        color: #6b7aad;
        margin-top: 4px;
      }
    </style>
  </head>
  <body>
    <!-- State A: Connecting (auto-retry active) -->
    <main id="connecting" class="card">
      <h1><span class="spinner"></span>Starting server...</h1>
      <p>Quoroom is starting up. This usually takes a few seconds.</p>
      <p id="status" class="status"></p>
    </main>

    <!-- State B: Failed (auto-retry exhausted) -->
    <main id="failed" class="card" style="display:none">
      <h1>You're offline</h1>
      <p>Quoroom cannot reach the server right now.</p>
      <button type="button" id="retry-btn">Retry</button>
      <p style="margin-top:12px"><a href="mailto:hello@email.quoroom.ai?subject=Offline issue&body=Quoroom is not reachable." style="color:#a9b3d9;font-size:13px">Email Developer</a></p>
    </main>

    <script>
      (function () {
        var MAX_ATTEMPTS = 10;
        var INTERVAL_MS = 2000;
        var attempt = 0;
        var connecting = document.getElementById('connecting');
        var failed = document.getElementById('failed');
        var status = document.getElementById('status');
        var retryBtn = document.getElementById('retry-btn');

        function tryConnect() {
          attempt++;
          if (status) status.textContent = 'Attempt ' + attempt + ' of ' + MAX_ATTEMPTS + '...';

          fetch('/api/status', { cache: 'no-store' })
            .then(function (res) {
              if (res.ok) { location.reload(); return; }
              scheduleNext();
            })
            .catch(function () {
              scheduleNext();
            });
        }

        function scheduleNext() {
          if (attempt >= MAX_ATTEMPTS) {
            connecting.style.display = 'none';
            failed.style.display = 'block';
            return;
          }
          setTimeout(tryConnect, INTERVAL_MS);
        }

        function restart() {
          attempt = 0;
          failed.style.display = 'none';
          connecting.style.display = 'block';
          tryConnect();
        }

        retryBtn.addEventListener('click', restart);
        tryConnect();
      })();
    </script>
  </body>
</html>
